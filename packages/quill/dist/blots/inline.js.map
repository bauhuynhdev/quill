{"version":3,"file":"inline.js","names":["EmbedBlot","InlineBlot","Scope","Break","Text","Inline","allowedChildren","order","compare","self","other","selfIndex","indexOf","otherIndex","formatAt","index","length","name","value","statics","blotName","scroll","query","BLOT","blot","isolate","wrap","optimize","context","parent","offset","moveChildren"],"sources":["../../src/blots/inline.ts"],"sourcesContent":["import { EmbedBlot, InlineBlot, Scope } from 'parchment';\r\nimport type { BlotConstructor } from 'parchment';\r\nimport Break from './break.js';\r\nimport Text from './text.js';\r\n\r\nclass Inline extends InlineBlot {\r\n  static allowedChildren: BlotConstructor[] = [Inline, Break, EmbedBlot, Text];\r\n  // Lower index means deeper in the DOM tree, since not found (-1) is for embeds\r\n  static order = [\r\n    'cursor',\r\n    'inline', // Must be lower\r\n    'link', // Chrome wants <a> to be lower\r\n    'underline',\r\n    'strike',\r\n    'italic',\r\n    'bold',\r\n    'script',\r\n    'code', // Must be higher\r\n  ];\r\n\r\n  static compare(self: string, other: string) {\r\n    const selfIndex = Inline.order.indexOf(self);\r\n    const otherIndex = Inline.order.indexOf(other);\r\n    if (selfIndex >= 0 || otherIndex >= 0) {\r\n      return selfIndex - otherIndex;\r\n    }\r\n    if (self === other) {\r\n      return 0;\r\n    }\r\n    if (self < other) {\r\n      return -1;\r\n    }\r\n    return 1;\r\n  }\r\n\r\n  formatAt(index: number, length: number, name: string, value: unknown) {\r\n    if (\r\n      Inline.compare(this.statics.blotName, name) < 0 &&\r\n      this.scroll.query(name, Scope.BLOT)\r\n    ) {\r\n      const blot = this.isolate(index, length);\r\n      if (value) {\r\n        blot.wrap(name, value);\r\n      }\r\n    } else {\r\n      super.formatAt(index, length, name, value);\r\n    }\r\n  }\r\n\r\n  optimize(context: { [key: string]: any }) {\r\n    super.optimize(context);\r\n    if (\r\n      this.parent instanceof Inline &&\r\n      Inline.compare(this.statics.blotName, this.parent.statics.blotName) > 0\r\n    ) {\r\n      const parent = this.parent.isolate(this.offset(), this.length());\r\n      // @ts-expect-error TODO: make isolate generic\r\n      this.moveChildren(parent);\r\n      parent.wrap(this);\r\n    }\r\n  }\r\n}\r\n\r\nexport default Inline;\r\n"],"mappings":"AAAA,SAASA,SAAS,EAAEC,UAAU,EAAEC,KAAK,QAAQ,WAAW;AAExD,OAAOC,KAAK,MAAM,YAAY;AAC9B,OAAOC,IAAI,MAAM,WAAW;AAE5B,MAAMC,MAAM,SAASJ,UAAU,CAAC;EAC9B,OAAOK,eAAe,GAAsB,CAACD,MAAM,EAAEF,KAAK,EAAEH,SAAS,EAAEI,IAAI,CAAC;EAC5E;EACA,OAAOG,KAAK,GAAG,CACb,QAAQ,EACR,QAAQ;EAAE;EACV,MAAM;EAAE;EACR,WAAW,EACX,QAAQ,EACR,QAAQ,EACR,MAAM,EACN,QAAQ,EACR,MAAM,CAAE;EAAA,CACT;EAED,OAAOC,OAAOA,CAACC,IAAY,EAAEC,KAAa,EAAE;IAC1C,MAAMC,SAAS,GAAGN,MAAM,CAACE,KAAK,CAACK,OAAO,CAACH,IAAI,CAAC;IAC5C,MAAMI,UAAU,GAAGR,MAAM,CAACE,KAAK,CAACK,OAAO,CAACF,KAAK,CAAC;IAC9C,IAAIC,SAAS,IAAI,CAAC,IAAIE,UAAU,IAAI,CAAC,EAAE;MACrC,OAAOF,SAAS,GAAGE,UAAU;IAC/B;IACA,IAAIJ,IAAI,KAAKC,KAAK,EAAE;MAClB,OAAO,CAAC;IACV;IACA,IAAID,IAAI,GAAGC,KAAK,EAAE;MAChB,OAAO,CAAC,CAAC;IACX;IACA,OAAO,CAAC;EACV;EAEAI,QAAQA,CAACC,KAAa,EAAEC,MAAc,EAAEC,IAAY,EAAEC,KAAc,EAAE;IACpE,IACEb,MAAM,CAACG,OAAO,CAAC,IAAI,CAACW,OAAO,CAACC,QAAQ,EAAEH,IAAI,CAAC,GAAG,CAAC,IAC/C,IAAI,CAACI,MAAM,CAACC,KAAK,CAACL,IAAI,EAAEf,KAAK,CAACqB,IAAI,CAAC,EACnC;MACA,MAAMC,IAAI,GAAG,IAAI,CAACC,OAAO,CAACV,KAAK,EAAEC,MAAM,CAAC;MACxC,IAAIE,KAAK,EAAE;QACTM,IAAI,CAACE,IAAI,CAACT,IAAI,EAAEC,KAAK,CAAC;MACxB;IACF,CAAC,MAAM;MACL,KAAK,CAACJ,QAAQ,CAACC,KAAK,EAAEC,MAAM,EAAEC,IAAI,EAAEC,KAAK,CAAC;IAC5C;EACF;EAEAS,QAAQA,CAACC,OAA+B,EAAE;IACxC,KAAK,CAACD,QAAQ,CAACC,OAAO,CAAC;IACvB,IACE,IAAI,CAACC,MAAM,YAAYxB,MAAM,IAC7BA,MAAM,CAACG,OAAO,CAAC,IAAI,CAACW,OAAO,CAACC,QAAQ,EAAE,IAAI,CAACS,MAAM,CAACV,OAAO,CAACC,QAAQ,CAAC,GAAG,CAAC,EACvE;MACA,MAAMS,MAAM,GAAG,IAAI,CAACA,MAAM,CAACJ,OAAO,CAAC,IAAI,CAACK,MAAM,CAAC,CAAC,EAAE,IAAI,CAACd,MAAM,CAAC,CAAC,CAAC;MAChE;MACA,IAAI,CAACe,YAAY,CAACF,MAAM,CAAC;MACzBA,MAAM,CAACH,IAAI,CAAC,IAAI,CAAC;IACnB;EACF;AACF;AAEA,eAAerB,MAAM","ignoreList":[]}