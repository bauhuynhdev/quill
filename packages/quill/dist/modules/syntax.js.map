{"version":3,"file":"syntax.js","names":["Delta","ClassAttributor","Scope","Inline","Quill","Module","blockDelta","BreakBlot","CursorBlot","TextBlot","escapeText","CodeBlock","CodeBlockContainer","traverse","TokenAttributor","scope","INLINE","CodeToken","formats","node","scroll","domNode","classList","contains","className","parentNode","undefined","constructor","value","add","format","blotName","remove","statics","optimize","arguments","unwrap","SyntaxCodeBlock","create","setAttribute","getAttribute","register","name","replaceWith","formatAt","length","SyntaxCodeBlockContainer","attach","forceNext","emitMount","children","forEach","child","index","highlight","forced","head","nodes","Array","from","childNodes","filter","uiNode","text","map","textContent","join","language","cachedText","trim","oldDelta","reduce","delta","concat","diff","_ref","retain","attributes","Object","keys","includes","html","codeBlock","find","code","context","parent","allowedChildren","requiredContainer","lib","versionString","majorVersion","split","parseInt","Syntax","quill","options","hljs","Error","languages","memo","_ref2","key","highlightBlot","bind","initListener","initTimer","on","events","SCROLL_BLOT_MOUNT","blot","select","root","ownerDocument","createElement","_ref3","label","option","appendChild","addEventListener","focus","attachUI","timer","SCROLL_OPTIMIZE","clearTimeout","setTimeout","interval","force","selection","composing","update","sources","USER","range","getSelection","blots","descendants","container","SILENT","setSelection","line","i","insert","innerHTML","compose","data","nodeText","WeakMap","DEFAULTS","window","default"],"sources":["../../src/modules/syntax.ts"],"sourcesContent":["import Delta from 'quill-delta';\r\nimport { ClassAttributor, Scope } from 'parchment';\r\nimport type { Blot, ScrollBlot } from 'parchment';\r\nimport Inline from '../blots/inline.js';\r\nimport Quill from '../core/quill.js';\r\nimport Module from '../core/module.js';\r\nimport { blockDelta } from '../blots/block.js';\r\nimport BreakBlot from '../blots/break.js';\r\nimport CursorBlot from '../blots/cursor.js';\r\nimport TextBlot, { escapeText } from '../blots/text.js';\r\nimport CodeBlock, { CodeBlockContainer } from '../formats/code.js';\r\nimport { traverse } from './clipboard.js';\r\n\r\nconst TokenAttributor = new ClassAttributor('code-token', 'hljs', {\r\n  scope: Scope.INLINE,\r\n});\r\nclass CodeToken extends Inline {\r\n  static formats(node: Element, scroll: ScrollBlot) {\r\n    while (node != null && node !== scroll.domNode) {\r\n      if (node.classList && node.classList.contains(CodeBlock.className)) {\r\n        // @ts-expect-error\r\n        return super.formats(node, scroll);\r\n      }\r\n      // @ts-expect-error\r\n      node = node.parentNode;\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  constructor(scroll: ScrollBlot, domNode: Node, value: unknown) {\r\n    // @ts-expect-error\r\n    super(scroll, domNode, value);\r\n    TokenAttributor.add(this.domNode, value);\r\n  }\r\n\r\n  format(format: string, value: unknown) {\r\n    if (format !== CodeToken.blotName) {\r\n      super.format(format, value);\r\n    } else if (value) {\r\n      TokenAttributor.add(this.domNode, value);\r\n    } else {\r\n      TokenAttributor.remove(this.domNode);\r\n      this.domNode.classList.remove(this.statics.className);\r\n    }\r\n  }\r\n\r\n  optimize(...args: unknown[]) {\r\n    // @ts-expect-error\r\n    super.optimize(...args);\r\n    if (!TokenAttributor.value(this.domNode)) {\r\n      this.unwrap();\r\n    }\r\n  }\r\n}\r\nCodeToken.blotName = 'code-token';\r\nCodeToken.className = 'ql-token';\r\n\r\nclass SyntaxCodeBlock extends CodeBlock {\r\n  static create(value: unknown) {\r\n    const domNode = super.create(value);\r\n    if (typeof value === 'string') {\r\n      domNode.setAttribute('data-language', value);\r\n    }\r\n    return domNode;\r\n  }\r\n\r\n  static formats(domNode: Node) {\r\n    // @ts-expect-error\r\n    return domNode.getAttribute('data-language') || 'plain';\r\n  }\r\n\r\n  static register() {} // Syntax module will register\r\n\r\n  format(name: string, value: unknown) {\r\n    if (name === this.statics.blotName && value) {\r\n      // @ts-expect-error\r\n      this.domNode.setAttribute('data-language', value);\r\n    } else {\r\n      super.format(name, value);\r\n    }\r\n  }\r\n\r\n  replaceWith(name: string | Blot, value?: any) {\r\n    this.formatAt(0, this.length(), CodeToken.blotName, false);\r\n    return super.replaceWith(name, value);\r\n  }\r\n}\r\n\r\nclass SyntaxCodeBlockContainer extends CodeBlockContainer {\r\n  forceNext?: boolean;\r\n  cachedText?: string | null;\r\n\r\n  attach() {\r\n    super.attach();\r\n    this.forceNext = false;\r\n    // @ts-expect-error\r\n    this.scroll.emitMount(this);\r\n  }\r\n\r\n  format(name: string, value: unknown) {\r\n    if (name === SyntaxCodeBlock.blotName) {\r\n      this.forceNext = true;\r\n      this.children.forEach((child) => {\r\n        // @ts-expect-error\r\n        child.format(name, value);\r\n      });\r\n    }\r\n  }\r\n\r\n  formatAt(index: number, length: number, name: string, value: unknown) {\r\n    if (name === SyntaxCodeBlock.blotName) {\r\n      this.forceNext = true;\r\n    }\r\n    super.formatAt(index, length, name, value);\r\n  }\r\n\r\n  highlight(\r\n    highlight: (text: string, language: string) => Delta,\r\n    forced = false,\r\n  ) {\r\n    if (this.children.head == null) return;\r\n    const nodes = Array.from(this.domNode.childNodes).filter(\r\n      (node) => node !== this.uiNode,\r\n    );\r\n    const text = `${nodes.map((node) => node.textContent).join('\\n')}\\n`;\r\n    const language = SyntaxCodeBlock.formats(this.children.head.domNode);\r\n    if (forced || this.forceNext || this.cachedText !== text) {\r\n      if (text.trim().length > 0 || this.cachedText == null) {\r\n        const oldDelta = this.children.reduce((delta, child) => {\r\n          // @ts-expect-error\r\n          return delta.concat(blockDelta(child, false));\r\n        }, new Delta());\r\n        const delta = highlight(text, language);\r\n        oldDelta.diff(delta).reduce((index, { retain, attributes }) => {\r\n          // Should be all retains\r\n          if (!retain) return index;\r\n          if (attributes) {\r\n            Object.keys(attributes).forEach((format) => {\r\n              if (\r\n                [SyntaxCodeBlock.blotName, CodeToken.blotName].includes(format)\r\n              ) {\r\n                // @ts-expect-error\r\n                this.formatAt(index, retain, format, attributes[format]);\r\n              }\r\n            });\r\n          }\r\n          // @ts-expect-error\r\n          return index + retain;\r\n        }, 0);\r\n      }\r\n      this.cachedText = text;\r\n      this.forceNext = false;\r\n    }\r\n  }\r\n\r\n  html(index: number, length: number) {\r\n    const [codeBlock] = this.children.find(index);\r\n    const language = codeBlock\r\n      ? SyntaxCodeBlock.formats(codeBlock.domNode)\r\n      : 'plain';\r\n\r\n    return `<pre data-language=\"${language}\">\\n${escapeText(\r\n      this.code(index, length),\r\n    )}\\n</pre>`;\r\n  }\r\n\r\n  optimize(context: Record<string, any>) {\r\n    super.optimize(context);\r\n    if (\r\n      this.parent != null &&\r\n      this.children.head != null &&\r\n      this.uiNode != null\r\n    ) {\r\n      const language = SyntaxCodeBlock.formats(this.children.head.domNode);\r\n      // @ts-expect-error\r\n      if (language !== this.uiNode.value) {\r\n        // @ts-expect-error\r\n        this.uiNode.value = language;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nSyntaxCodeBlockContainer.allowedChildren = [SyntaxCodeBlock];\r\nSyntaxCodeBlock.requiredContainer = SyntaxCodeBlockContainer;\r\nSyntaxCodeBlock.allowedChildren = [CodeToken, CursorBlot, TextBlot, BreakBlot];\r\n\r\ninterface SyntaxOptions {\r\n  interval: number;\r\n  languages: { key: string; label: string }[];\r\n  hljs: any;\r\n}\r\n\r\nconst highlight = (lib: any, language: string, text: string) => {\r\n  if (typeof lib.versionString === 'string') {\r\n    const majorVersion = lib.versionString.split('.')[0];\r\n    if (parseInt(majorVersion, 10) >= 11) {\r\n      return lib.highlight(text, { language }).value;\r\n    }\r\n  }\r\n  return lib.highlight(language, text).value;\r\n};\r\n\r\nclass Syntax extends Module<SyntaxOptions> {\r\n  static DEFAULTS: SyntaxOptions & { hljs: any };\r\n\r\n  static register() {\r\n    Quill.register(CodeToken, true);\r\n    Quill.register(SyntaxCodeBlock, true);\r\n    Quill.register(SyntaxCodeBlockContainer, true);\r\n  }\r\n\r\n  languages: Record<string, true>;\r\n\r\n  constructor(quill: Quill, options: Partial<SyntaxOptions>) {\r\n    super(quill, options);\r\n    if (this.options.hljs == null) {\r\n      throw new Error(\r\n        'Syntax module requires highlight.js. Please include the library on the page before Quill.',\r\n      );\r\n    }\r\n    // @ts-expect-error Fix me later\r\n    this.languages = this.options.languages.reduce(\r\n      (memo: Record<string, unknown>, { key }) => {\r\n        memo[key] = true;\r\n        return memo;\r\n      },\r\n      {},\r\n    );\r\n    this.highlightBlot = this.highlightBlot.bind(this);\r\n    this.initListener();\r\n    this.initTimer();\r\n  }\r\n\r\n  initListener() {\r\n    this.quill.on(Quill.events.SCROLL_BLOT_MOUNT, (blot: Blot) => {\r\n      if (!(blot instanceof SyntaxCodeBlockContainer)) return;\r\n      const select = this.quill.root.ownerDocument.createElement('select');\r\n      // @ts-expect-error Fix me later\r\n      this.options.languages.forEach(({ key, label }) => {\r\n        const option = select.ownerDocument.createElement('option');\r\n        option.textContent = label;\r\n        option.setAttribute('value', key);\r\n        select.appendChild(option);\r\n      });\r\n      select.addEventListener('change', () => {\r\n        blot.format(SyntaxCodeBlock.blotName, select.value);\r\n        this.quill.root.focus(); // Prevent scrolling\r\n        this.highlight(blot, true);\r\n      });\r\n      if (blot.uiNode == null) {\r\n        blot.attachUI(select);\r\n        if (blot.children.head) {\r\n          select.value = SyntaxCodeBlock.formats(blot.children.head.domNode);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  initTimer() {\r\n    let timer: ReturnType<typeof setTimeout> | null = null;\r\n    this.quill.on(Quill.events.SCROLL_OPTIMIZE, () => {\r\n      if (timer) {\r\n        clearTimeout(timer);\r\n      }\r\n      timer = setTimeout(() => {\r\n        this.highlight();\r\n        timer = null;\r\n      }, this.options.interval);\r\n    });\r\n  }\r\n\r\n  highlight(blot: SyntaxCodeBlockContainer | null = null, force = false) {\r\n    if (this.quill.selection.composing) return;\r\n    this.quill.update(Quill.sources.USER);\r\n    const range = this.quill.getSelection();\r\n    const blots =\r\n      blot == null\r\n        ? this.quill.scroll.descendants(SyntaxCodeBlockContainer)\r\n        : [blot];\r\n    blots.forEach((container) => {\r\n      container.highlight(this.highlightBlot, force);\r\n    });\r\n    this.quill.update(Quill.sources.SILENT);\r\n    if (range != null) {\r\n      this.quill.setSelection(range, Quill.sources.SILENT);\r\n    }\r\n  }\r\n\r\n  highlightBlot(text: string, language = 'plain') {\r\n    language = this.languages[language] ? language : 'plain';\r\n    if (language === 'plain') {\r\n      return escapeText(text)\r\n        .split('\\n')\r\n        .reduce((delta, line, i) => {\r\n          if (i !== 0) {\r\n            delta.insert('\\n', { [CodeBlock.blotName]: language });\r\n          }\r\n          return delta.insert(line);\r\n        }, new Delta());\r\n    }\r\n    const container = this.quill.root.ownerDocument.createElement('div');\r\n    container.classList.add(CodeBlock.className);\r\n    container.innerHTML = highlight(this.options.hljs, language, text);\r\n    return traverse(\r\n      this.quill.scroll,\r\n      container,\r\n      [\r\n        (node, delta) => {\r\n          // @ts-expect-error\r\n          const value = TokenAttributor.value(node);\r\n          if (value) {\r\n            return delta.compose(\r\n              new Delta().retain(delta.length(), {\r\n                [CodeToken.blotName]: value,\r\n              }),\r\n            );\r\n          }\r\n          return delta;\r\n        },\r\n      ],\r\n      [\r\n        (node, delta) => {\r\n          // @ts-expect-error\r\n          return node.data.split('\\n').reduce((memo, nodeText, i) => {\r\n            if (i !== 0) memo.insert('\\n', { [CodeBlock.blotName]: language });\r\n            return memo.insert(nodeText);\r\n          }, delta);\r\n        },\r\n      ],\r\n      new WeakMap(),\r\n    );\r\n  }\r\n}\r\nSyntax.DEFAULTS = {\r\n  hljs: (() => {\r\n    return window.hljs;\r\n  })(),\r\n  interval: 1000,\r\n  languages: [\r\n    { key: 'plain', label: 'Plain' },\r\n    { key: 'bash', label: 'Bash' },\r\n    { key: 'cpp', label: 'C++' },\r\n    { key: 'cs', label: 'C#' },\r\n    { key: 'css', label: 'CSS' },\r\n    { key: 'diff', label: 'Diff' },\r\n    { key: 'xml', label: 'HTML/XML' },\r\n    { key: 'java', label: 'Java' },\r\n    { key: 'javascript', label: 'JavaScript' },\r\n    { key: 'markdown', label: 'Markdown' },\r\n    { key: 'php', label: 'PHP' },\r\n    { key: 'python', label: 'Python' },\r\n    { key: 'ruby', label: 'Ruby' },\r\n    { key: 'sql', label: 'SQL' },\r\n  ],\r\n};\r\n\r\nexport { SyntaxCodeBlock as CodeBlock, CodeToken, Syntax as default };\r\n"],"mappings":"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","ignoreList":[]}