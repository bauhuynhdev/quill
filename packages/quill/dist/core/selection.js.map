{"version":3,"file":"selection.js","names":["LeafBlot","Scope","cloneDeep","isEqual","Emitter","logger","debug","Range","constructor","index","length","arguments","undefined","Selection","scroll","emitter","composing","mouseDown","root","domNode","cursor","create","savedRange","lastRange","lastNative","handleComposition","handleDragging","listenDOM","document","setTimeout","update","bind","sources","USER","on","events","SCROLL_BEFORE_UPDATE","hasFocus","native","getNativeRange","start","node","textNode","once","SCROLL_UPDATE","source","mutations","contains","end","setNativeRange","offset","triggeredByTyping","some","mutation","type","target","SILENT","ignored","SCROLL_OPTIMIZE","context","range","startNode","startOffset","endNode","endOffset","COMPOSITION_BEFORE_START","COMPOSITION_END","parent","restore","body","focus","preventScroll","setRange","format","value","nativeRange","collapsed","query","BLOCK","blot","find","after","split","insertBefore","attach","optimize","data","getBounds","scrollLength","Math","min","leaf","next","line","nextLine","position","createRange","setStart","setEnd","getBoundingClientRect","side","rect","Text","Element","bottom","top","height","left","right","width","selection","getSelection","rangeCount","getRangeAt","normalizeNative","info","getRange","isConnected","normalized","normalizedToRange","activeElement","positions","push","indexes","map","max","startContainer","endContainer","forEach","childNodes","lastChild","rangeToNative","getPosition","inclusive","leafOffset","force","parentNode","tagName","Array","from","indexOf","removeAllRanges","addRange","blur","API","args","oldRange","SELECTION_CHANGE","emit","EDITOR_CHANGE","descendant","e"],"sources":["../../src/core/selection.ts"],"sourcesContent":["import { LeafBlot, Scope } from 'parchment';\r\nimport { cloneDeep, isEqual } from 'lodash-es';\r\nimport Emitter from './emitter.js';\r\nimport type { EmitterSource } from './emitter.js';\r\nimport logger from './logger.js';\r\nimport type Cursor from '../blots/cursor.js';\r\nimport type Scroll from '../blots/scroll.js';\r\n\r\nconst debug = logger('quill:selection');\r\n\r\ntype NativeRange = AbstractRange;\r\n\r\ninterface NormalizedRange {\r\n  start: {\r\n    node: NativeRange['startContainer'];\r\n    offset: NativeRange['startOffset'];\r\n  };\r\n  end: { node: NativeRange['endContainer']; offset: NativeRange['endOffset'] };\r\n  native: NativeRange;\r\n}\r\n\r\nexport interface Bounds {\r\n  bottom: number;\r\n  height: number;\r\n  left: number;\r\n  right: number;\r\n  top: number;\r\n  width: number;\r\n}\r\n\r\nexport class Range {\r\n  constructor(\r\n    public index: number,\r\n    public length = 0,\r\n  ) {}\r\n}\r\n\r\nclass Selection {\r\n  scroll: Scroll;\r\n  emitter: Emitter;\r\n  composing: boolean;\r\n  mouseDown: boolean;\r\n\r\n  root: HTMLElement;\r\n  cursor: Cursor;\r\n  savedRange: Range;\r\n  lastRange: Range | null;\r\n  lastNative: NormalizedRange | null;\r\n\r\n  constructor(scroll: Scroll, emitter: Emitter) {\r\n    this.emitter = emitter;\r\n    this.scroll = scroll;\r\n    this.composing = false;\r\n    this.mouseDown = false;\r\n    this.root = this.scroll.domNode;\r\n    // @ts-expect-error\r\n    this.cursor = this.scroll.create('cursor', this);\r\n    // savedRange is last non-null range\r\n    this.savedRange = new Range(0, 0);\r\n    this.lastRange = this.savedRange;\r\n    this.lastNative = null;\r\n    this.handleComposition();\r\n    this.handleDragging();\r\n    this.emitter.listenDOM('selectionchange', document, () => {\r\n      if (!this.mouseDown && !this.composing) {\r\n        setTimeout(this.update.bind(this, Emitter.sources.USER), 1);\r\n      }\r\n    });\r\n    this.emitter.on(Emitter.events.SCROLL_BEFORE_UPDATE, () => {\r\n      if (!this.hasFocus()) return;\r\n      const native = this.getNativeRange();\r\n      if (native == null) return;\r\n      if (native.start.node === this.cursor.textNode) return; // cursor.restore() will handle\r\n      this.emitter.once(\r\n        Emitter.events.SCROLL_UPDATE,\r\n        (source, mutations: MutationRecord[]) => {\r\n          try {\r\n            if (\r\n              this.root.contains(native.start.node) &&\r\n              this.root.contains(native.end.node)\r\n            ) {\r\n              this.setNativeRange(\r\n                native.start.node,\r\n                native.start.offset,\r\n                native.end.node,\r\n                native.end.offset,\r\n              );\r\n            }\r\n            const triggeredByTyping = mutations.some(\r\n              (mutation) =>\r\n                mutation.type === 'characterData' ||\r\n                mutation.type === 'childList' ||\r\n                (mutation.type === 'attributes' &&\r\n                  mutation.target === this.root),\r\n            );\r\n            this.update(triggeredByTyping ? Emitter.sources.SILENT : source);\r\n          } catch (ignored) {\r\n            // ignore\r\n          }\r\n        },\r\n      );\r\n    });\r\n    this.emitter.on(Emitter.events.SCROLL_OPTIMIZE, (mutations, context) => {\r\n      if (context.range) {\r\n        const { startNode, startOffset, endNode, endOffset } = context.range;\r\n        this.setNativeRange(startNode, startOffset, endNode, endOffset);\r\n        this.update(Emitter.sources.SILENT);\r\n      }\r\n    });\r\n    this.update(Emitter.sources.SILENT);\r\n  }\r\n\r\n  handleComposition() {\r\n    this.emitter.on(Emitter.events.COMPOSITION_BEFORE_START, () => {\r\n      this.composing = true;\r\n    });\r\n    this.emitter.on(Emitter.events.COMPOSITION_END, () => {\r\n      this.composing = false;\r\n      if (this.cursor.parent) {\r\n        const range = this.cursor.restore();\r\n        if (!range) return;\r\n        setTimeout(() => {\r\n          this.setNativeRange(\r\n            range.startNode,\r\n            range.startOffset,\r\n            range.endNode,\r\n            range.endOffset,\r\n          );\r\n        }, 1);\r\n      }\r\n    });\r\n  }\r\n\r\n  handleDragging() {\r\n    this.emitter.listenDOM('mousedown', document.body, () => {\r\n      this.mouseDown = true;\r\n    });\r\n    this.emitter.listenDOM('mouseup', document.body, () => {\r\n      this.mouseDown = false;\r\n      this.update(Emitter.sources.USER);\r\n    });\r\n  }\r\n\r\n  focus() {\r\n    if (this.hasFocus()) return;\r\n    this.root.focus({ preventScroll: true });\r\n    this.setRange(this.savedRange);\r\n  }\r\n\r\n  format(format: string, value: unknown) {\r\n    this.scroll.update();\r\n    const nativeRange = this.getNativeRange();\r\n    if (\r\n      nativeRange == null ||\r\n      !nativeRange.native.collapsed ||\r\n      this.scroll.query(format, Scope.BLOCK)\r\n    )\r\n      return;\r\n    if (nativeRange.start.node !== this.cursor.textNode) {\r\n      const blot = this.scroll.find(nativeRange.start.node, false);\r\n      if (blot == null) return;\r\n      // TODO Give blot ability to not split\r\n      if (blot instanceof LeafBlot) {\r\n        const after = blot.split(nativeRange.start.offset);\r\n        blot.parent.insertBefore(this.cursor, after);\r\n      } else {\r\n        // @ts-expect-error TODO: nativeRange.start.node doesn't seem to match function signature\r\n        blot.insertBefore(this.cursor, nativeRange.start.node); // Should never happen\r\n      }\r\n      this.cursor.attach();\r\n    }\r\n    this.cursor.format(format, value);\r\n    this.scroll.optimize();\r\n    this.setNativeRange(this.cursor.textNode, this.cursor.textNode.data.length);\r\n    this.update();\r\n  }\r\n\r\n  getBounds(index: number, length = 0) {\r\n    const scrollLength = this.scroll.length();\r\n    index = Math.min(index, scrollLength - 1);\r\n    length = Math.min(index + length, scrollLength - 1) - index;\r\n    let node: Node;\r\n    let [leaf, offset] = this.scroll.leaf(index);\r\n    if (leaf == null) return null;\r\n    if (length > 0 && offset === leaf.length()) {\r\n      const [next] = this.scroll.leaf(index + 1);\r\n      if (next) {\r\n        const [line] = this.scroll.line(index);\r\n        const [nextLine] = this.scroll.line(index + 1);\r\n        if (line === nextLine) {\r\n          leaf = next;\r\n          offset = 0;\r\n        }\r\n      }\r\n    }\r\n    [node, offset] = leaf.position(offset, true);\r\n    const range = document.createRange();\r\n    if (length > 0) {\r\n      range.setStart(node, offset);\r\n      [leaf, offset] = this.scroll.leaf(index + length);\r\n      if (leaf == null) return null;\r\n      [node, offset] = leaf.position(offset, true);\r\n      range.setEnd(node, offset);\r\n      return range.getBoundingClientRect();\r\n    }\r\n    let side: 'left' | 'right' = 'left';\r\n    let rect: DOMRect;\r\n    if (node instanceof Text) {\r\n      // Return null if the text node is empty because it is\r\n      // not able to get a useful client rect:\r\n      // https://github.com/w3c/csswg-drafts/issues/2514.\r\n      // Empty text nodes are most likely caused by TextBlot#optimize()\r\n      // not getting called when editor content changes.\r\n      if (!node.data.length) {\r\n        return null;\r\n      }\r\n      if (offset < node.data.length) {\r\n        range.setStart(node, offset);\r\n        range.setEnd(node, offset + 1);\r\n      } else {\r\n        range.setStart(node, offset - 1);\r\n        range.setEnd(node, offset);\r\n        side = 'right';\r\n      }\r\n      rect = range.getBoundingClientRect();\r\n    } else {\r\n      if (!(leaf.domNode instanceof Element)) return null;\r\n      rect = leaf.domNode.getBoundingClientRect();\r\n      if (offset > 0) side = 'right';\r\n    }\r\n    return {\r\n      bottom: rect.top + rect.height,\r\n      height: rect.height,\r\n      left: rect[side],\r\n      right: rect[side],\r\n      top: rect.top,\r\n      width: 0,\r\n    };\r\n  }\r\n\r\n  getNativeRange(): NormalizedRange | null {\r\n    const selection = document.getSelection();\r\n    if (selection == null || selection.rangeCount <= 0) return null;\r\n    const nativeRange = selection.getRangeAt(0);\r\n    if (nativeRange == null) return null;\r\n    const range = this.normalizeNative(nativeRange);\r\n    debug.info('getNativeRange', range);\r\n    return range;\r\n  }\r\n\r\n  getRange(): [Range, NormalizedRange] | [null, null] {\r\n    const root = this.scroll.domNode;\r\n    if ('isConnected' in root && !root.isConnected) {\r\n      // document.getSelection() forces layout on Blink, so we trend to\r\n      // not calling it.\r\n      return [null, null];\r\n    }\r\n    const normalized = this.getNativeRange();\r\n    if (normalized == null) return [null, null];\r\n    const range = this.normalizedToRange(normalized);\r\n    return [range, normalized];\r\n  }\r\n\r\n  hasFocus(): boolean {\r\n    return (\r\n      document.activeElement === this.root ||\r\n      (document.activeElement != null &&\r\n        contains(this.root, document.activeElement))\r\n    );\r\n  }\r\n\r\n  normalizedToRange(range: NormalizedRange) {\r\n    const positions: [Node, number][] = [\r\n      [range.start.node, range.start.offset],\r\n    ];\r\n    if (!range.native.collapsed) {\r\n      positions.push([range.end.node, range.end.offset]);\r\n    }\r\n    const indexes = positions.map((position) => {\r\n      const [node, offset] = position;\r\n      const blot = this.scroll.find(node, true);\r\n      // @ts-expect-error Fix me later\r\n      const index = blot.offset(this.scroll);\r\n      if (offset === 0) {\r\n        return index;\r\n      }\r\n      if (blot instanceof LeafBlot) {\r\n        return index + blot.index(node, offset);\r\n      }\r\n      // @ts-expect-error Fix me later\r\n      return index + blot.length();\r\n    });\r\n    const end = Math.min(Math.max(...indexes), this.scroll.length() - 1);\r\n    const start = Math.min(end, ...indexes);\r\n    return new Range(start, end - start);\r\n  }\r\n\r\n  normalizeNative(nativeRange: NativeRange) {\r\n    if (\r\n      !contains(this.root, nativeRange.startContainer) ||\r\n      (!nativeRange.collapsed && !contains(this.root, nativeRange.endContainer))\r\n    ) {\r\n      return null;\r\n    }\r\n    const range = {\r\n      start: {\r\n        node: nativeRange.startContainer,\r\n        offset: nativeRange.startOffset,\r\n      },\r\n      end: { node: nativeRange.endContainer, offset: nativeRange.endOffset },\r\n      native: nativeRange,\r\n    };\r\n    [range.start, range.end].forEach((position) => {\r\n      let { node, offset } = position;\r\n      while (!(node instanceof Text) && node.childNodes.length > 0) {\r\n        if (node.childNodes.length > offset) {\r\n          node = node.childNodes[offset];\r\n          offset = 0;\r\n        } else if (node.childNodes.length === offset) {\r\n          // @ts-expect-error Fix me later\r\n          node = node.lastChild;\r\n          if (node instanceof Text) {\r\n            offset = node.data.length;\r\n          } else if (node.childNodes.length > 0) {\r\n            // Container case\r\n            offset = node.childNodes.length;\r\n          } else {\r\n            // Embed case\r\n            offset = node.childNodes.length + 1;\r\n          }\r\n        } else {\r\n          break;\r\n        }\r\n      }\r\n      position.node = node;\r\n      position.offset = offset;\r\n    });\r\n    return range;\r\n  }\r\n\r\n  rangeToNative(range: Range): [Node | null, number, Node | null, number] {\r\n    const scrollLength = this.scroll.length();\r\n\r\n    const getPosition = (\r\n      index: number,\r\n      inclusive: boolean,\r\n    ): [Node | null, number] => {\r\n      index = Math.min(scrollLength - 1, index);\r\n      const [leaf, leafOffset] = this.scroll.leaf(index);\r\n      return leaf ? leaf.position(leafOffset, inclusive) : [null, -1];\r\n    };\r\n    return [\r\n      ...getPosition(range.index, false),\r\n      ...getPosition(range.index + range.length, true),\r\n    ];\r\n  }\r\n\r\n  setNativeRange(\r\n    startNode: Node | null,\r\n    startOffset?: number,\r\n    endNode = startNode,\r\n    endOffset = startOffset,\r\n    force = false,\r\n  ) {\r\n    debug.info('setNativeRange', startNode, startOffset, endNode, endOffset);\r\n    if (\r\n      startNode != null &&\r\n      (this.root.parentNode == null ||\r\n        startNode.parentNode == null ||\r\n        // @ts-expect-error Fix me later\r\n        endNode.parentNode == null)\r\n    ) {\r\n      return;\r\n    }\r\n    const selection = document.getSelection();\r\n    if (selection == null) return;\r\n    if (startNode != null) {\r\n      if (!this.hasFocus()) this.root.focus({ preventScroll: true });\r\n      const { native } = this.getNativeRange() || {};\r\n      if (\r\n        native == null ||\r\n        force ||\r\n        startNode !== native.startContainer ||\r\n        startOffset !== native.startOffset ||\r\n        endNode !== native.endContainer ||\r\n        endOffset !== native.endOffset\r\n      ) {\r\n        if (startNode instanceof Element && startNode.tagName === 'BR') {\r\n          // @ts-expect-error Fix me later\r\n          startOffset = Array.from(startNode.parentNode.childNodes).indexOf(\r\n            startNode,\r\n          );\r\n          startNode = startNode.parentNode;\r\n        }\r\n        if (endNode instanceof Element && endNode.tagName === 'BR') {\r\n          // @ts-expect-error Fix me later\r\n          endOffset = Array.from(endNode.parentNode.childNodes).indexOf(\r\n            endNode,\r\n          );\r\n          endNode = endNode.parentNode;\r\n        }\r\n        const range = document.createRange();\r\n        // @ts-expect-error Fix me later\r\n        range.setStart(startNode, startOffset);\r\n        // @ts-expect-error Fix me later\r\n        range.setEnd(endNode, endOffset);\r\n        selection.removeAllRanges();\r\n        selection.addRange(range);\r\n      }\r\n    } else {\r\n      selection.removeAllRanges();\r\n      this.root.blur();\r\n    }\r\n  }\r\n\r\n  setRange(range: Range | null, force: boolean, source?: EmitterSource): void;\r\n  setRange(range: Range | null, source?: EmitterSource): void;\r\n  setRange(\r\n    range: Range | null,\r\n    force: boolean | EmitterSource = false,\r\n    source: EmitterSource = Emitter.sources.API,\r\n  ): void {\r\n    if (typeof force === 'string') {\r\n      source = force;\r\n      force = false;\r\n    }\r\n    debug.info('setRange', range);\r\n    if (range != null) {\r\n      const args = this.rangeToNative(range);\r\n      this.setNativeRange(...args, force);\r\n    } else {\r\n      this.setNativeRange(null);\r\n    }\r\n    this.update(source);\r\n  }\r\n\r\n  update(source: EmitterSource = Emitter.sources.USER) {\r\n    const oldRange = this.lastRange;\r\n    const [lastRange, nativeRange] = this.getRange();\r\n    this.lastRange = lastRange;\r\n    this.lastNative = nativeRange;\r\n    if (this.lastRange != null) {\r\n      this.savedRange = this.lastRange;\r\n    }\r\n    if (!isEqual(oldRange, this.lastRange)) {\r\n      if (\r\n        !this.composing &&\r\n        nativeRange != null &&\r\n        nativeRange.native.collapsed &&\r\n        nativeRange.start.node !== this.cursor.textNode\r\n      ) {\r\n        const range = this.cursor.restore();\r\n        if (range) {\r\n          this.setNativeRange(\r\n            range.startNode,\r\n            range.startOffset,\r\n            range.endNode,\r\n            range.endOffset,\r\n          );\r\n        }\r\n      }\r\n      const args = [\r\n        Emitter.events.SELECTION_CHANGE,\r\n        cloneDeep(this.lastRange),\r\n        cloneDeep(oldRange),\r\n        source,\r\n      ];\r\n      this.emitter.emit(Emitter.events.EDITOR_CHANGE, ...args);\r\n      if (source !== Emitter.sources.SILENT) {\r\n        this.emitter.emit(...args);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction contains(parent: Node, descendant: Node) {\r\n  try {\r\n    // Firefox inserts inaccessible nodes around video elements\r\n    descendant.parentNode; // eslint-disable-line @typescript-eslint/no-unused-expressions\r\n  } catch (e) {\r\n    return false;\r\n  }\r\n  return parent.contains(descendant);\r\n}\r\n\r\nexport default Selection;\r\n"],"mappings":"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","ignoreList":[]}