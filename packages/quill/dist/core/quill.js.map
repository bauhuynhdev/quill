{"version":3,"file":"quill.js","names":["merge","Parchment","Delta","Editor","Emitter","instances","logger","Module","Selection","Range","Composition","Theme","scrollRectIntoView","createRegistryWithFormats","debug","globalRegistry","Registry","ParentBlot","uiClass","Quill","DEFAULTS","bounds","modules","clipboard","keyboard","history","uploader","placeholder","readOnly","registry","theme","events","sources","version","imports","delta","parchment","limit","level","find","node","bubble","arguments","length","undefined","get","import","name","error","register","target","overwrite","attrName","blotName","Object","keys","forEach","key","path","warn","startsWith","constructor","container","options","expandConfig","html","innerHTML","trim","classList","add","set","root","addContainer","emitter","scrollBlotName","ScrollBlot","query","Error","scroll","editor","selection","composition","addModule","init","on","EDITOR_CHANGE","type","TEXT_CHANGE","toggle","isBlank","SCROLL_UPDATE","source","mutations","oldRange","lastRange","newRange","getRange","selectionInfo","modify","call","update","SCROLL_EMBED_UPDATE","blot","change","retain","offset","statics","USER","contents","convert","text","setContents","clear","setAttribute","disable","allowReadOnlyEdits","refNode","className","document","createElement","insertBefore","blur","setRange","deleteText","index","overload","enable","editReadOnly","modifier","value","enabled","focus","preventScroll","scrollSelectionIntoView","format","API","range","getSelection","Scope","BLOCK","formatLine","formatText","setSelection","SILENT","formats","getBounds","containerBounds","getBoundingClientRect","bottom","top","height","left","right","width","getContents","getLength","getFormat","getIndex","getLeaf","leaf","getLine","line","getLines","Number","MAX_VALUE","lines","getModule","getSemanticHTML","getHTML","getText","hasFocus","insertEmbed","embed","insertText","isEnabled","off","once","removeFormat","rect","scrollIntoView","console","delete1","applied","insertContents","delete2","compose","Math","max","setText","insert","updateContents","applyDelta","resolveSelector","selector","querySelector","expandModuleConfig","config","entries","reduce","expanded","_ref","omitUndefinedValuesFromOptions","obj","fromEntries","filter","entry","containerOrSelector","shouldUseDefaultTheme","quillModuleDefaults","quillDefaults","themeModuleDefaults","themeDefaults","userModuleOptions","toolbar","modulesWithDefaults","_ref2","moduleClass","shift","oldDelta","shiftRange","args","emit","lengthOrSource","start","end","transformPosition","map","pos","default"],"sources":["../../src/core/quill.ts"],"sourcesContent":["import { merge } from 'lodash-es';\r\nimport * as Parchment from 'parchment';\r\nimport type { Op } from 'quill-delta';\r\nimport Delta from 'quill-delta';\r\nimport type { BlockEmbed } from '../blots/block.js';\r\nimport type Block from '../blots/block.js';\r\nimport type Scroll from '../blots/scroll.js';\r\nimport type Clipboard from '../modules/clipboard.js';\r\nimport type History from '../modules/history.js';\r\nimport type Keyboard from '../modules/keyboard.js';\r\nimport type Uploader from '../modules/uploader.js';\r\nimport Editor from './editor.js';\r\nimport Emitter from './emitter.js';\r\nimport type { EmitterSource } from './emitter.js';\r\nimport instances from './instances.js';\r\nimport logger from './logger.js';\r\nimport type { DebugLevel } from './logger.js';\r\nimport Module from './module.js';\r\nimport Selection, { Range } from './selection.js';\r\nimport type { Bounds } from './selection.js';\r\nimport Composition from './composition.js';\r\nimport Theme from './theme.js';\r\nimport type { ThemeConstructor } from './theme.js';\r\nimport scrollRectIntoView from './utils/scrollRectIntoView.js';\r\nimport type { Rect } from './utils/scrollRectIntoView.js';\r\nimport createRegistryWithFormats from './utils/createRegistryWithFormats.js';\r\n\r\nconst debug = logger('quill');\r\n\r\nconst globalRegistry = new Parchment.Registry();\r\nParchment.ParentBlot.uiClass = 'ql-ui';\r\n\r\n/**\r\n * Options for initializing a Quill instance\r\n */\r\nexport interface QuillOptions {\r\n  theme?: string;\r\n  debug?: DebugLevel | boolean;\r\n  registry?: Parchment.Registry;\r\n  /**\r\n   * Whether to disable the editing\r\n   * @default false\r\n   */\r\n  readOnly?: boolean;\r\n\r\n  /**\r\n   * Placeholder text to display when the editor is empty\r\n   * @default \"\"\r\n   */\r\n  placeholder?: string;\r\n  bounds?: HTMLElement | string | null;\r\n  modules?: Record<string, unknown>;\r\n\r\n  /**\r\n   * A list of formats that are recognized and can exist within the editor contents.\r\n   * `null` means all formats are allowed.\r\n   * @default null\r\n   */\r\n  formats?: string[] | null;\r\n}\r\n\r\n/**\r\n * Similar to QuillOptions, but with all properties expanded to their default values,\r\n * and all selectors resolved to HTMLElements.\r\n */\r\nexport interface ExpandedQuillOptions\r\n  extends Omit<QuillOptions, 'theme' | 'formats'> {\r\n  theme: ThemeConstructor;\r\n  registry: Parchment.Registry;\r\n  container: HTMLElement;\r\n  modules: Record<string, unknown>;\r\n  bounds?: HTMLElement | null;\r\n  readOnly: boolean;\r\n}\r\n\r\nclass Quill {\r\n  static DEFAULTS = {\r\n    bounds: null,\r\n    modules: {\r\n      clipboard: true,\r\n      keyboard: true,\r\n      history: true,\r\n      uploader: true,\r\n    },\r\n    placeholder: '',\r\n    readOnly: false,\r\n    registry: globalRegistry,\r\n    theme: 'default',\r\n  } satisfies Partial<QuillOptions>;\r\n  static events = Emitter.events;\r\n  static sources = Emitter.sources;\r\n  static version = typeof QUILL_VERSION === 'undefined' ? 'dev' : QUILL_VERSION;\r\n\r\n  static imports: Record<string, unknown> = {\r\n    delta: Delta,\r\n    parchment: Parchment,\r\n    'core/module': Module,\r\n    'core/theme': Theme,\r\n  };\r\n\r\n  static debug(limit: DebugLevel | boolean) {\r\n    if (limit === true) {\r\n      limit = 'log';\r\n    }\r\n    logger.level(limit);\r\n  }\r\n\r\n  static find(node: Node, bubble = false) {\r\n    return instances.get(node) || globalRegistry.find(node, bubble);\r\n  }\r\n\r\n  static import(name: 'core/module'): typeof Module;\r\n  static import(name: `themes/${string}`): typeof Theme;\r\n  static import(name: 'parchment'): typeof Parchment;\r\n  static import(name: 'delta'): typeof Delta;\r\n  static import(name: string): unknown;\r\n  static import(name: string) {\r\n    if (this.imports[name] == null) {\r\n      debug.error(`Cannot import ${name}. Are you sure it was registered?`);\r\n    }\r\n    return this.imports[name];\r\n  }\r\n\r\n  static register(\r\n    targets: Record<\r\n      string,\r\n      | Parchment.RegistryDefinition\r\n      | Record<string, unknown> // any objects\r\n      | Theme\r\n      | Module\r\n      | Function // ES5 constructors\r\n    >,\r\n    overwrite?: boolean,\r\n  ): void;\r\n  static register(\r\n    target: Parchment.RegistryDefinition,\r\n    overwrite?: boolean,\r\n  ): void;\r\n  static register(path: string, target: any, overwrite?: boolean): void;\r\n  static register(...args: any[]): void {\r\n    if (typeof args[0] !== 'string') {\r\n      const target = args[0];\r\n      const overwrite = !!args[1];\r\n\r\n      const name = 'attrName' in target ? target.attrName : target.blotName;\r\n      if (typeof name === 'string') {\r\n        // Shortcut for formats:\r\n        // register(Blot | Attributor, overwrite)\r\n        this.register(`formats/${name}`, target, overwrite);\r\n      } else {\r\n        Object.keys(target).forEach((key) => {\r\n          this.register(key, target[key], overwrite);\r\n        });\r\n      }\r\n    } else {\r\n      const path = args[0];\r\n      const target = args[1];\r\n      const overwrite = !!args[2];\r\n\r\n      if (this.imports[path] != null && !overwrite) {\r\n        debug.warn(`Overwriting ${path} with`, target);\r\n      }\r\n      this.imports[path] = target;\r\n      if (\r\n        (path.startsWith('blots/') || path.startsWith('formats/')) &&\r\n        target &&\r\n        typeof target !== 'boolean' &&\r\n        target.blotName !== 'abstract'\r\n      ) {\r\n        globalRegistry.register(target);\r\n      }\r\n      if (typeof target.register === 'function') {\r\n        target.register(globalRegistry);\r\n      }\r\n    }\r\n  }\r\n\r\n  container: HTMLElement;\r\n  root: HTMLDivElement;\r\n  scroll: Scroll;\r\n  emitter: Emitter;\r\n  protected allowReadOnlyEdits: boolean;\r\n  editor: Editor;\r\n  composition: Composition;\r\n  selection: Selection;\r\n\r\n  theme: Theme;\r\n  keyboard: Keyboard;\r\n  clipboard: Clipboard;\r\n  history: History;\r\n  uploader: Uploader;\r\n\r\n  options: ExpandedQuillOptions;\r\n\r\n  constructor(container: HTMLElement | string, options: QuillOptions = {}) {\r\n    this.options = expandConfig(container, options);\r\n    this.container = this.options.container;\r\n    if (this.container == null) {\r\n      debug.error('Invalid Quill container', container);\r\n      return;\r\n    }\r\n    if (this.options.debug) {\r\n      Quill.debug(this.options.debug);\r\n    }\r\n    const html = this.container.innerHTML.trim();\r\n    this.container.classList.add('ql-container');\r\n    this.container.innerHTML = '';\r\n    instances.set(this.container, this);\r\n    this.root = this.addContainer('ql-editor');\r\n    this.root.classList.add('ql-blank');\r\n    this.emitter = new Emitter();\r\n    const scrollBlotName = Parchment.ScrollBlot.blotName;\r\n    const ScrollBlot = this.options.registry.query(scrollBlotName);\r\n    if (!ScrollBlot || !('blotName' in ScrollBlot)) {\r\n      throw new Error(\r\n        `Cannot initialize Quill without \"${scrollBlotName}\" blot`,\r\n      );\r\n    }\r\n    this.scroll = new ScrollBlot(this.options.registry, this.root, {\r\n      emitter: this.emitter,\r\n    }) as Scroll;\r\n    this.editor = new Editor(this.scroll);\r\n    this.selection = new Selection(this.scroll, this.emitter);\r\n    this.composition = new Composition(this.scroll, this.emitter);\r\n    this.theme = new this.options.theme(this, this.options); // eslint-disable-line new-cap\r\n    this.keyboard = this.theme.addModule('keyboard');\r\n    this.clipboard = this.theme.addModule('clipboard');\r\n    this.history = this.theme.addModule('history');\r\n    this.uploader = this.theme.addModule('uploader');\r\n    this.theme.addModule('input');\r\n    this.theme.addModule('uiNode');\r\n    this.theme.init();\r\n    this.emitter.on(Emitter.events.EDITOR_CHANGE, (type) => {\r\n      if (type === Emitter.events.TEXT_CHANGE) {\r\n        this.root.classList.toggle('ql-blank', this.editor.isBlank());\r\n      }\r\n    });\r\n    this.emitter.on(Emitter.events.SCROLL_UPDATE, (source, mutations) => {\r\n      const oldRange = this.selection.lastRange;\r\n      const [newRange] = this.selection.getRange();\r\n      const selectionInfo =\r\n        oldRange && newRange ? { oldRange, newRange } : undefined;\r\n      modify.call(\r\n        this,\r\n        () => this.editor.update(null, mutations, selectionInfo),\r\n        source,\r\n      );\r\n    });\r\n    this.emitter.on(Emitter.events.SCROLL_EMBED_UPDATE, (blot, delta) => {\r\n      const oldRange = this.selection.lastRange;\r\n      const [newRange] = this.selection.getRange();\r\n      const selectionInfo =\r\n        oldRange && newRange ? { oldRange, newRange } : undefined;\r\n      modify.call(\r\n        this,\r\n        () => {\r\n          const change = new Delta()\r\n            .retain(blot.offset(this))\r\n            .retain({ [blot.statics.blotName]: delta });\r\n          return this.editor.update(change, [], selectionInfo);\r\n        },\r\n        Quill.sources.USER,\r\n      );\r\n    });\r\n    if (html) {\r\n      const contents = this.clipboard.convert({\r\n        html: `${html}<p><br></p>`,\r\n        text: '\\n',\r\n      });\r\n      this.setContents(contents);\r\n    }\r\n    this.history.clear();\r\n    if (this.options.placeholder) {\r\n      this.root.setAttribute('data-placeholder', this.options.placeholder);\r\n    }\r\n    if (this.options.readOnly) {\r\n      this.disable();\r\n    }\r\n    this.allowReadOnlyEdits = false;\r\n  }\r\n\r\n  addContainer(container: string, refNode?: Node | null): HTMLDivElement;\r\n  addContainer(container: HTMLElement, refNode?: Node | null): HTMLElement;\r\n  addContainer(\r\n    container: string | HTMLElement,\r\n    refNode: Node | null = null,\r\n  ): HTMLDivElement | HTMLElement {\r\n    if (typeof container === 'string') {\r\n      const className = container;\r\n      container = document.createElement('div');\r\n      container.classList.add(className);\r\n    }\r\n    this.container.insertBefore(container, refNode);\r\n    return container;\r\n  }\r\n\r\n  blur() {\r\n    this.selection.setRange(null);\r\n  }\r\n\r\n  deleteText(range: Range, source?: EmitterSource): Delta;\r\n  deleteText(index: number, length: number, source?: EmitterSource): Delta;\r\n  deleteText(\r\n    index: number | Range,\r\n    length?: number | EmitterSource,\r\n    source?: EmitterSource,\r\n  ): Delta {\r\n    // @ts-expect-error\r\n    [index, length, , source] = overload(index, length, source);\r\n    return modify.call(\r\n      this,\r\n      () => {\r\n        return this.editor.deleteText(index, length);\r\n      },\r\n      source,\r\n      index,\r\n      -1 * length,\r\n    );\r\n  }\r\n\r\n  disable() {\r\n    this.enable(false);\r\n  }\r\n\r\n  editReadOnly<T>(modifier: () => T): T {\r\n    this.allowReadOnlyEdits = true;\r\n    const value = modifier();\r\n    this.allowReadOnlyEdits = false;\r\n    return value;\r\n  }\r\n\r\n  enable(enabled = true) {\r\n    this.scroll.enable(enabled);\r\n    this.container.classList.toggle('ql-disabled', !enabled);\r\n  }\r\n\r\n  focus(options: { preventScroll?: boolean } = {}) {\r\n    this.selection.focus();\r\n    if (!options.preventScroll) {\r\n      this.scrollSelectionIntoView();\r\n    }\r\n  }\r\n\r\n  format(\r\n    name: string,\r\n    value: unknown,\r\n    source: EmitterSource = Emitter.sources.API,\r\n  ): Delta {\r\n    return modify.call(\r\n      this,\r\n      () => {\r\n        const range = this.getSelection(true);\r\n        let change = new Delta();\r\n        if (range == null) return change;\r\n        if (this.scroll.query(name, Parchment.Scope.BLOCK)) {\r\n          change = this.editor.formatLine(range.index, range.length, {\r\n            [name]: value,\r\n          });\r\n        } else if (range.length === 0) {\r\n          this.selection.format(name, value);\r\n          return change;\r\n        } else {\r\n          change = this.editor.formatText(range.index, range.length, {\r\n            [name]: value,\r\n          });\r\n        }\r\n        this.setSelection(range, Emitter.sources.SILENT);\r\n        return change;\r\n      },\r\n      source,\r\n    );\r\n  }\r\n\r\n  formatLine(\r\n    index: number,\r\n    length: number,\r\n    formats: Record<string, unknown>,\r\n    source?: EmitterSource,\r\n  ): Delta;\r\n  formatLine(\r\n    index: number,\r\n    length: number,\r\n    name: string,\r\n    value?: unknown,\r\n    source?: EmitterSource,\r\n  ): Delta;\r\n  formatLine(\r\n    index: number,\r\n    length: number,\r\n    name: string | Record<string, unknown>,\r\n    value?: unknown | EmitterSource,\r\n    source?: EmitterSource,\r\n  ): Delta {\r\n    let formats: Record<string, unknown>;\r\n    // eslint-disable-next-line prefer-const\r\n    [index, length, formats, source] = overload(\r\n      index,\r\n      length,\r\n      // @ts-expect-error\r\n      name,\r\n      value,\r\n      source,\r\n    );\r\n    return modify.call(\r\n      this,\r\n      () => {\r\n        return this.editor.formatLine(index, length, formats);\r\n      },\r\n      source,\r\n      index,\r\n      0,\r\n    );\r\n  }\r\n\r\n  formatText(\r\n    range: Range,\r\n    name: string,\r\n    value: unknown,\r\n    source?: EmitterSource,\r\n  ): Delta;\r\n  formatText(\r\n    index: number,\r\n    length: number,\r\n    name: string,\r\n    value: unknown,\r\n    source?: EmitterSource,\r\n  ): Delta;\r\n  formatText(\r\n    index: number,\r\n    length: number,\r\n    formats: Record<string, unknown>,\r\n    source?: EmitterSource,\r\n  ): Delta;\r\n  formatText(\r\n    index: number | Range,\r\n    length: number | string,\r\n    name: string | unknown,\r\n    value?: unknown | EmitterSource,\r\n    source?: EmitterSource,\r\n  ): Delta {\r\n    let formats: Record<string, unknown>;\r\n    // eslint-disable-next-line prefer-const\r\n    [index, length, formats, source] = overload(\r\n      // @ts-expect-error\r\n      index,\r\n      length,\r\n      name,\r\n      value,\r\n      source,\r\n    );\r\n    return modify.call(\r\n      this,\r\n      () => {\r\n        return this.editor.formatText(index, length, formats);\r\n      },\r\n      source,\r\n      index,\r\n      0,\r\n    );\r\n  }\r\n\r\n  getBounds(index: number | Range, length = 0): Bounds | null {\r\n    let bounds: Bounds | null = null;\r\n    if (typeof index === 'number') {\r\n      bounds = this.selection.getBounds(index, length);\r\n    } else {\r\n      bounds = this.selection.getBounds(index.index, index.length);\r\n    }\r\n    if (!bounds) return null;\r\n    const containerBounds = this.container.getBoundingClientRect();\r\n    return {\r\n      bottom: bounds.bottom - containerBounds.top,\r\n      height: bounds.height,\r\n      left: bounds.left - containerBounds.left,\r\n      right: bounds.right - containerBounds.left,\r\n      top: bounds.top - containerBounds.top,\r\n      width: bounds.width,\r\n    };\r\n  }\r\n\r\n  getContents(index = 0, length = this.getLength() - index) {\r\n    [index, length] = overload(index, length);\r\n    return this.editor.getContents(index, length);\r\n  }\r\n\r\n  getFormat(index?: number, length?: number): { [format: string]: unknown };\r\n  getFormat(range?: Range): {\r\n    [format: string]: unknown;\r\n  };\r\n  getFormat(\r\n    index: Range | number = this.getSelection(true),\r\n    length = 0,\r\n  ): { [format: string]: unknown } {\r\n    if (typeof index === 'number') {\r\n      return this.editor.getFormat(index, length);\r\n    }\r\n    return this.editor.getFormat(index.index, index.length);\r\n  }\r\n\r\n  getIndex(blot: Parchment.Blot) {\r\n    return blot.offset(this.scroll);\r\n  }\r\n\r\n  getLength() {\r\n    return this.scroll.length();\r\n  }\r\n\r\n  getLeaf(index: number) {\r\n    return this.scroll.leaf(index);\r\n  }\r\n\r\n  getLine(index: number) {\r\n    return this.scroll.line(index);\r\n  }\r\n\r\n  getLines(range: Range): (Block | BlockEmbed)[];\r\n  getLines(index?: number, length?: number): (Block | BlockEmbed)[];\r\n  getLines(\r\n    index: Range | number = 0,\r\n    length = Number.MAX_VALUE,\r\n  ): (Block | BlockEmbed)[] {\r\n    if (typeof index !== 'number') {\r\n      return this.scroll.lines(index.index, index.length);\r\n    }\r\n    return this.scroll.lines(index, length);\r\n  }\r\n\r\n  getModule(name: string) {\r\n    return this.theme.modules[name];\r\n  }\r\n\r\n  getSelection(focus: true): Range;\r\n  getSelection(focus?: boolean): Range | null;\r\n  getSelection(focus = false): Range | null {\r\n    if (focus) this.focus();\r\n    this.update(); // Make sure we access getRange with editor in consistent state\r\n    return this.selection.getRange()[0];\r\n  }\r\n\r\n  getSemanticHTML(range: Range): string;\r\n  getSemanticHTML(index?: number, length?: number): string;\r\n  getSemanticHTML(index: Range | number = 0, length?: number) {\r\n    if (typeof index === 'number') {\r\n      length = length ?? this.getLength() - index;\r\n    }\r\n    // @ts-expect-error\r\n    [index, length] = overload(index, length);\r\n    return this.editor.getHTML(index, length);\r\n  }\r\n\r\n  getText(range?: Range): string;\r\n  getText(index?: number, length?: number): string;\r\n  getText(index: Range | number = 0, length?: number): string {\r\n    if (typeof index === 'number') {\r\n      length = length ?? this.getLength() - index;\r\n    }\r\n    // @ts-expect-error\r\n    [index, length] = overload(index, length);\r\n    return this.editor.getText(index, length);\r\n  }\r\n\r\n  hasFocus() {\r\n    return this.selection.hasFocus();\r\n  }\r\n\r\n  insertEmbed(\r\n    index: number,\r\n    embed: string,\r\n    value: unknown,\r\n    source: EmitterSource = Quill.sources.API,\r\n  ): Delta {\r\n    return modify.call(\r\n      this,\r\n      () => {\r\n        return this.editor.insertEmbed(index, embed, value);\r\n      },\r\n      source,\r\n      index,\r\n    );\r\n  }\r\n\r\n  insertText(index: number, text: string, source?: EmitterSource): Delta;\r\n  insertText(\r\n    index: number,\r\n    text: string,\r\n    formats: Record<string, unknown>,\r\n    source?: EmitterSource,\r\n  ): Delta;\r\n  insertText(\r\n    index: number,\r\n    text: string,\r\n    name: string,\r\n    value: unknown,\r\n    source?: EmitterSource,\r\n  ): Delta;\r\n  insertText(\r\n    index: number,\r\n    text: string,\r\n    name?: string | Record<string, unknown> | EmitterSource,\r\n    value?: unknown,\r\n    source?: EmitterSource,\r\n  ): Delta {\r\n    let formats: Record<string, unknown>;\r\n    // eslint-disable-next-line prefer-const\r\n    // @ts-expect-error\r\n    [index, , formats, source] = overload(index, 0, name, value, source);\r\n    return modify.call(\r\n      this,\r\n      () => {\r\n        return this.editor.insertText(index, text, formats);\r\n      },\r\n      source,\r\n      index,\r\n      text.length,\r\n    );\r\n  }\r\n\r\n  isEnabled() {\r\n    return this.scroll.isEnabled();\r\n  }\r\n\r\n  off(...args: Parameters<(typeof Emitter)['prototype']['off']>) {\r\n    return this.emitter.off(...args);\r\n  }\r\n\r\n  on(\r\n    event: (typeof Emitter)['events']['TEXT_CHANGE'],\r\n    handler: (delta: Delta, oldContent: Delta, source: EmitterSource) => void,\r\n  ): Emitter;\r\n  on(\r\n    event: (typeof Emitter)['events']['SELECTION_CHANGE'],\r\n    handler: (range: Range, oldRange: Range, source: EmitterSource) => void,\r\n  ): Emitter;\r\n  on(\r\n    event: (typeof Emitter)['events']['EDITOR_CHANGE'],\r\n    handler: (\r\n      ...args:\r\n        | [\r\n            (typeof Emitter)['events']['TEXT_CHANGE'],\r\n            Delta,\r\n            Delta,\r\n            EmitterSource,\r\n          ]\r\n        | [\r\n            (typeof Emitter)['events']['SELECTION_CHANGE'],\r\n            Range,\r\n            Range,\r\n            EmitterSource,\r\n          ]\r\n    ) => void,\r\n  ): Emitter;\r\n  on(event: string, ...args: unknown[]): Emitter;\r\n  on(...args: Parameters<(typeof Emitter)['prototype']['on']>): Emitter {\r\n    return this.emitter.on(...args);\r\n  }\r\n\r\n  once(...args: Parameters<(typeof Emitter)['prototype']['once']>) {\r\n    return this.emitter.once(...args);\r\n  }\r\n\r\n  removeFormat(index: number, length: number, source?: EmitterSource): Delta {\r\n    [index, length, , source] = overload(index, length, source);\r\n    return modify.call(\r\n      this,\r\n      () => {\r\n        return this.editor.removeFormat(index, length);\r\n      },\r\n      source,\r\n      index,\r\n    );\r\n  }\r\n\r\n  scrollRectIntoView(rect: Rect) {\r\n    scrollRectIntoView(this.root, rect);\r\n  }\r\n\r\n  /**\r\n   * @deprecated Use Quill#scrollSelectionIntoView() instead.\r\n   */\r\n  scrollIntoView() {\r\n    console.warn(\r\n      'Quill#scrollIntoView() has been deprecated and will be removed in the near future. Please use Quill#scrollSelectionIntoView() instead.',\r\n    );\r\n    this.scrollSelectionIntoView();\r\n  }\r\n\r\n  /**\r\n   * Scroll the current selection into the visible area.\r\n   * If the selection is already visible, no scrolling will occur.\r\n   */\r\n  scrollSelectionIntoView() {\r\n    const range = this.selection.lastRange;\r\n    const bounds = range && this.selection.getBounds(range.index, range.length);\r\n    if (bounds) {\r\n      this.scrollRectIntoView(bounds);\r\n    }\r\n  }\r\n\r\n  setContents(\r\n    delta: Delta | Op[],\r\n    source: EmitterSource = Emitter.sources.API,\r\n  ): Delta {\r\n    return modify.call(\r\n      this,\r\n      () => {\r\n        delta = new Delta(delta);\r\n        const length = this.getLength();\r\n        // Quill will set empty editor to \\n\r\n        const delete1 = this.editor.deleteText(0, length);\r\n        const applied = this.editor.insertContents(0, delta);\r\n        // Remove extra \\n from empty editor initialization\r\n        const delete2 = this.editor.deleteText(this.getLength() - 1, 1);\r\n        return delete1.compose(applied).compose(delete2);\r\n      },\r\n      source,\r\n    );\r\n  }\r\n  setSelection(range: Range | null, source?: EmitterSource): void;\r\n  setSelection(index: number, source?: EmitterSource): void;\r\n  setSelection(index: number, length?: number, source?: EmitterSource): void;\r\n  setSelection(index: number, source?: EmitterSource): void;\r\n  setSelection(\r\n    index: Range | null | number,\r\n    length?: EmitterSource | number,\r\n    source?: EmitterSource,\r\n  ): void {\r\n    if (index == null) {\r\n      // @ts-expect-error https://github.com/microsoft/TypeScript/issues/22609\r\n      this.selection.setRange(null, length || Quill.sources.API);\r\n    } else {\r\n      // @ts-expect-error\r\n      [index, length, , source] = overload(index, length, source);\r\n      this.selection.setRange(new Range(Math.max(0, index), length), source);\r\n      if (source !== Emitter.sources.SILENT) {\r\n        this.scrollSelectionIntoView();\r\n      }\r\n    }\r\n  }\r\n\r\n  setText(text: string, source: EmitterSource = Emitter.sources.API) {\r\n    const delta = new Delta().insert(text);\r\n    return this.setContents(delta, source);\r\n  }\r\n\r\n  update(source: EmitterSource = Emitter.sources.USER) {\r\n    const change = this.scroll.update(source); // Will update selection before selection.update() does if text changes\r\n    this.selection.update(source);\r\n    // TODO this is usually undefined\r\n    return change;\r\n  }\r\n\r\n  updateContents(\r\n    delta: Delta | Op[],\r\n    source: EmitterSource = Emitter.sources.API,\r\n  ): Delta {\r\n    return modify.call(\r\n      this,\r\n      () => {\r\n        delta = new Delta(delta);\r\n        return this.editor.applyDelta(delta);\r\n      },\r\n      source,\r\n      true,\r\n    );\r\n  }\r\n}\r\n\r\nfunction resolveSelector(selector: string | HTMLElement | null | undefined) {\r\n  return typeof selector === 'string'\r\n    ? document.querySelector<HTMLElement>(selector)\r\n    : selector;\r\n}\r\n\r\nfunction expandModuleConfig(config: Record<string, unknown> | undefined) {\r\n  return Object.entries(config ?? {}).reduce(\r\n    (expanded, [key, value]) => ({\r\n      ...expanded,\r\n      [key]: value === true ? {} : value,\r\n    }),\r\n    {} as Record<string, unknown>,\r\n  );\r\n}\r\n\r\nfunction omitUndefinedValuesFromOptions(obj: QuillOptions) {\r\n  return Object.fromEntries(\r\n    Object.entries(obj).filter((entry) => entry[1] !== undefined),\r\n  );\r\n}\r\n\r\nfunction expandConfig(\r\n  containerOrSelector: HTMLElement | string,\r\n  options: QuillOptions,\r\n): ExpandedQuillOptions {\r\n  const container = resolveSelector(containerOrSelector);\r\n  if (!container) {\r\n    throw new Error('Invalid Quill container');\r\n  }\r\n\r\n  const shouldUseDefaultTheme =\r\n    !options.theme || options.theme === Quill.DEFAULTS.theme;\r\n  const theme = shouldUseDefaultTheme\r\n    ? Theme\r\n    : Quill.import(`themes/${options.theme}`);\r\n  if (!theme) {\r\n    throw new Error(`Invalid theme ${options.theme}. Did you register it?`);\r\n  }\r\n\r\n  const { modules: quillModuleDefaults, ...quillDefaults } = Quill.DEFAULTS;\r\n  const { modules: themeModuleDefaults, ...themeDefaults } = theme.DEFAULTS;\r\n\r\n  let userModuleOptions = expandModuleConfig(options.modules);\r\n  // Special case toolbar shorthand\r\n  if (\r\n    userModuleOptions != null &&\r\n    userModuleOptions.toolbar &&\r\n    userModuleOptions.toolbar.constructor !== Object\r\n  ) {\r\n    userModuleOptions = {\r\n      ...userModuleOptions,\r\n      toolbar: { container: userModuleOptions.toolbar },\r\n    };\r\n  }\r\n\r\n  const modules: ExpandedQuillOptions['modules'] = merge(\r\n    {},\r\n    expandModuleConfig(quillModuleDefaults),\r\n    expandModuleConfig(themeModuleDefaults),\r\n    userModuleOptions,\r\n  );\r\n\r\n  const config = {\r\n    ...quillDefaults,\r\n    ...omitUndefinedValuesFromOptions(themeDefaults),\r\n    ...omitUndefinedValuesFromOptions(options),\r\n  };\r\n\r\n  let registry = options.registry;\r\n  if (registry) {\r\n    if (options.formats) {\r\n      debug.warn('Ignoring \"formats\" option because \"registry\" is specified');\r\n    }\r\n  } else {\r\n    registry = options.formats\r\n      ? createRegistryWithFormats(options.formats, config.registry, debug)\r\n      : config.registry;\r\n  }\r\n\r\n  return {\r\n    ...config,\r\n    registry,\r\n    container,\r\n    theme,\r\n    modules: Object.entries(modules).reduce(\r\n      (modulesWithDefaults, [name, value]) => {\r\n        if (!value) return modulesWithDefaults;\r\n\r\n        const moduleClass = Quill.import(`modules/${name}`);\r\n        if (moduleClass == null) {\r\n          debug.error(\r\n            `Cannot load ${name} module. Are you sure you registered it?`,\r\n          );\r\n          return modulesWithDefaults;\r\n        }\r\n        return {\r\n          ...modulesWithDefaults,\r\n          // @ts-expect-error\r\n          [name]: merge({}, moduleClass.DEFAULTS || {}, value),\r\n        };\r\n      },\r\n      {},\r\n    ),\r\n    bounds: resolveSelector(config.bounds),\r\n  };\r\n}\r\n\r\n// Handle selection preservation and TEXT_CHANGE emission\r\n// common to modification APIs\r\nfunction modify(\r\n  modifier: () => Delta,\r\n  source: EmitterSource,\r\n  index: number | boolean,\r\n  shift: number | null,\r\n) {\r\n  if (\r\n    !this.isEnabled() &&\r\n    source === Emitter.sources.USER &&\r\n    !this.allowReadOnlyEdits\r\n  ) {\r\n    return new Delta();\r\n  }\r\n  let range = index == null ? null : this.getSelection();\r\n  const oldDelta = this.editor.delta;\r\n  const change = modifier();\r\n  if (range != null) {\r\n    if (index === true) {\r\n      index = range.index; // eslint-disable-line prefer-destructuring\r\n    }\r\n    if (shift == null) {\r\n      range = shiftRange(range, change, source);\r\n    } else if (shift !== 0) {\r\n      // @ts-expect-error index should always be number\r\n      range = shiftRange(range, index, shift, source);\r\n    }\r\n    this.setSelection(range, Emitter.sources.SILENT);\r\n  }\r\n  if (change.length() > 0) {\r\n    const args = [Emitter.events.TEXT_CHANGE, change, oldDelta, source];\r\n    this.emitter.emit(Emitter.events.EDITOR_CHANGE, ...args);\r\n    if (source !== Emitter.sources.SILENT) {\r\n      this.emitter.emit(...args);\r\n    }\r\n  }\r\n  return change;\r\n}\r\n\r\ntype NormalizedIndexLength = [\r\n  number,\r\n  number,\r\n  Record<string, unknown>,\r\n  EmitterSource,\r\n];\r\nfunction overload(index: number, source?: EmitterSource): NormalizedIndexLength;\r\nfunction overload(\r\n  index: number,\r\n  length: number,\r\n  source?: EmitterSource,\r\n): NormalizedIndexLength;\r\nfunction overload(\r\n  index: number,\r\n  length: number,\r\n  format: string,\r\n  value: unknown,\r\n  source?: EmitterSource,\r\n): NormalizedIndexLength;\r\nfunction overload(\r\n  index: number,\r\n  length: number,\r\n  format: Record<string, unknown>,\r\n  source?: EmitterSource,\r\n): NormalizedIndexLength;\r\nfunction overload(range: Range, source?: EmitterSource): NormalizedIndexLength;\r\nfunction overload(\r\n  range: Range,\r\n  format: string,\r\n  value: unknown,\r\n  source?: EmitterSource,\r\n): NormalizedIndexLength;\r\nfunction overload(\r\n  range: Range,\r\n  format: Record<string, unknown>,\r\n  source?: EmitterSource,\r\n): NormalizedIndexLength;\r\nfunction overload(\r\n  index: Range | number,\r\n  length?: number | string | Record<string, unknown> | EmitterSource,\r\n  name?: string | unknown | Record<string, unknown> | EmitterSource,\r\n  value?: unknown | EmitterSource,\r\n  source?: EmitterSource,\r\n): NormalizedIndexLength {\r\n  let formats: Record<string, unknown> = {};\r\n  // @ts-expect-error\r\n  if (typeof index.index === 'number' && typeof index.length === 'number') {\r\n    // Allow for throwaway end (used by insertText/insertEmbed)\r\n    if (typeof length !== 'number') {\r\n      // @ts-expect-error\r\n      source = value;\r\n      value = name;\r\n      name = length;\r\n      // @ts-expect-error\r\n      length = index.length; // eslint-disable-line prefer-destructuring\r\n      // @ts-expect-error\r\n      index = index.index; // eslint-disable-line prefer-destructuring\r\n    } else {\r\n      // @ts-expect-error\r\n      length = index.length; // eslint-disable-line prefer-destructuring\r\n      // @ts-expect-error\r\n      index = index.index; // eslint-disable-line prefer-destructuring\r\n    }\r\n  } else if (typeof length !== 'number') {\r\n    // @ts-expect-error\r\n    source = value;\r\n    value = name;\r\n    name = length;\r\n    length = 0;\r\n  }\r\n  // Handle format being object, two format name/value strings or excluded\r\n  if (typeof name === 'object') {\r\n    // @ts-expect-error Fix me later\r\n    formats = name;\r\n    // @ts-expect-error\r\n    source = value;\r\n  } else if (typeof name === 'string') {\r\n    if (value != null) {\r\n      formats[name] = value;\r\n    } else {\r\n      // @ts-expect-error\r\n      source = name;\r\n    }\r\n  }\r\n  // Handle optional source\r\n  source = source || Emitter.sources.API;\r\n  // @ts-expect-error\r\n  return [index, length, formats, source];\r\n}\r\n\r\nfunction shiftRange(range: Range, change: Delta, source?: EmitterSource): Range;\r\nfunction shiftRange(\r\n  range: Range,\r\n  index: number,\r\n  length?: number,\r\n  source?: EmitterSource,\r\n): Range;\r\nfunction shiftRange(\r\n  range: Range,\r\n  index: number | Delta,\r\n  lengthOrSource?: number | EmitterSource,\r\n  source?: EmitterSource,\r\n) {\r\n  const length = typeof lengthOrSource === 'number' ? lengthOrSource : 0;\r\n  if (range == null) return null;\r\n  let start;\r\n  let end;\r\n  // @ts-expect-error -- TODO: add a better type guard around `index`\r\n  if (index && typeof index.transformPosition === 'function') {\r\n    [start, end] = [range.index, range.index + range.length].map((pos) =>\r\n      // @ts-expect-error -- TODO: add a better type guard around `index`\r\n      index.transformPosition(pos, source !== Emitter.sources.USER),\r\n    );\r\n  } else {\r\n    [start, end] = [range.index, range.index + range.length].map((pos) => {\r\n      // @ts-expect-error -- TODO: add a better type guard around `index`\r\n      if (pos < index || (pos === index && source === Emitter.sources.USER))\r\n        return pos;\r\n      if (length >= 0) {\r\n        return pos + length;\r\n      }\r\n      // @ts-expect-error -- TODO: add a better type guard around `index`\r\n      return Math.max(index, pos + length);\r\n    });\r\n  }\r\n  return new Range(start, end - start);\r\n}\r\n\r\nexport type { Bounds, DebugLevel, EmitterSource };\r\nexport { Parchment, Range };\r\n\r\nexport { globalRegistry, expandConfig, overload, Quill as default };\r\n"],"mappings":"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","ignoreList":[]}